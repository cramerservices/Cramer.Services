<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>All Services — Cramer Services</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f8f9fb;--card:#fff;--accent:#0d6efd;--text:#1b1f24;--muted:#6c757d;--ring:0 0 0 3px rgba(13,110,253,.25)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,Arial,sans-serif;background:var(--bg);color:var(--text)}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  .container{max-width:1100px;margin:auto;padding:1rem}
  .cta{background:var(--accent);color:#fff;font-weight:600;padding:.65rem 1rem;border:0;border-radius:6px;cursor:pointer;display:inline-block}
  .cta:hover{background:#0b5ed7}
  .header-bar{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
  .header-bar h1{margin:0}
  .muted{color:var(--muted)}

  /* Tiles (match index look) */
  .services-tiles{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:1rem;
    margin-top:1rem;
    margin-bottom:2rem;
  }
  .service-tile{background:transparent;border:0;padding:0}
  .service-tile h3{margin:.2rem 0 .6rem}
  .service-imgwrap{
    position:relative;
    border-radius:12px;
    overflow:hidden;
    height:200px;
    margin-bottom:.5rem;
    box-shadow:0 8px 20px rgba(0,0,0,.08);
    display:block;
  }
  .service-imgwrap img,
  .service-imgwrap video{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    border-radius:12px;
  }
  /* NEW: make embeds fill tile */
  .service-imgwrap iframe{
    width:100%;
    height:100%;
    border:0;
    display:block;
    border-radius:12px;
  }

  .service-overlay{
    position:absolute;inset:0;background:rgba(0,0,0,.55);color:#fff;
    opacity:0;transition:opacity .2s;display:flex;align-items:center;
    justify-content:center;text-align:center;padding:1rem;border-radius:12px
  }
  .service-imgwrap:hover .service-overlay{opacity:1}

  .price{font-weight:800}
  .price s{font-weight:500;color:var(--muted);margin-left:.35rem}
</style>
</head>
<body>
  <main class="container">
    <div class="header-bar">
      <h1>All Services</h1>
      <a class="cta" href="index.html#contact">Contact Us</a>
    </div>

    <p class="muted">Browse and select a service to view details and book.</p>
    <p style="font-weight:600; margin:.5rem 0 1rem; color:var(--text);">
      Can’t find your service listed below? Reach out through our
      <a href="index.html#contact" style="color:var(--accent); font-weight:600;">Contact Us</a> button.
    </p>

    <div id="servicesGrid" class="services-tiles"></div>

    <a class="cta" href="index.html">Back to Home</a>
  </main>

<script>
(async function(){
  const grid = document.getElementById('servicesGrid');

  const esc = (s='') => String(s)
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;').replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');

  const money = v => {
    if (v == null || v === '') return '';
    const n = Number(String(v).replace(/[^0-9.-]/g,''));
    return isFinite(n) ? n.toLocaleString(undefined,{style:'currency',currency:'USD'}) : esc(v);
  };

  let services = [];
  try{
    const res = await fetch('data/services.json', { cache:'no-cache' });
    if (!res.ok) throw new Error(res.status);
    services = await res.json();
  }catch(err){
    console.error('Could not load data/services.json:', err);
    grid.innerHTML = '<p class="muted">Could not load services.</p>';
    return;
  }

  const makeTile = (svc) => {
    const art = document.createElement('article');
    art.className = 'service-tile';

    const h3 = document.createElement('h3');
    h3.textContent = svc.name || '';
    art.appendChild(h3);

    const a = document.createElement('a');
    a.className = 'service-imgwrap';
    a.href = `service.html?slug=${encodeURIComponent(svc.slug || '')}`;

    // -- One column for media (same as your Excel/JSON 'image' field) --
    const mediaUrl = (svc.image || '').trim();

    // Build media element based on URL
    const media = buildMedia(mediaUrl, svc.name || 'Service');
    if (media) a.appendChild(media);

    const overlay = document.createElement('div');
    overlay.className = 'service-overlay';
    overlay.textContent = svc.description || '';
    a.appendChild(overlay);

    art.appendChild(a);

    // Optional price block (only if provided in JSON)
    const hasPrice = svc.price != null && svc.price !== '';
    const hasSale  = svc.salePrice != null && svc.salePrice !== '';
    if (hasPrice || hasSale) {
      const price = document.createElement('div');
      price.className = 'price';
      price.innerHTML = `${hasPrice ? money(svc.price) : ''}${hasSale ? ` <s>${money(svc.salePrice)}</s>` : ''}`;
      art.appendChild(price);
    }

    return art;
  };

  // Create <img>, <video>, or <iframe> from a single URL
  function buildMedia(url, altText){
    if (!url) return null;

    // YouTube
    const yt = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_\-]+)/i);
    if (yt) {
      const id = yt[1];
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube.com/embed/${id}`;
      iframe.title = 'YouTube video player';
      iframe.loading = 'lazy';
      iframe.referrerPolicy = 'strict-origin-when-cross-origin';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
      iframe.setAttribute('allowfullscreen','');
      return iframe;
    }

    // Vimeo
    const vm = url.match(/vimeo\.com\/(\d+)/i);
    if (vm) {
      const iframe = document.createElement('iframe');
      iframe.src = `https://player.vimeo.com/video/${vm[1]}`;
      iframe.title = 'Vimeo video player';
      iframe.loading = 'lazy';
      iframe.allow = 'autoplay; fullscreen; picture-in-picture';
      iframe.setAttribute('allowfullscreen','');
      return iframe;
    }

    // Direct file by extension (strip query/hash)
    const clean = url.split('?')[0].split('#')[0];
    const ext = (clean.match(/\.(\w+)$/) || [,''])[1].toLowerCase();
    const videoTypes = { mp4:'video/mp4', webm:'video/webm', ogv:'video/ogg', mov:'video/quicktime' };
    const isVideo = !!videoTypes[ext];

    if (isVideo) {
      const v = document.createElement('video');
      v.muted = true;
      v.loop = true;
      v.autoplay = true;
      v.playsInline = true;
      v.preload = 'metadata';
      const src = document.createElement('source');
      src.src = url;
      src.type = videoTypes[ext];
      v.appendChild(src);

      // Smooth slow-mo preview (best-effort)
      v.addEventListener('loadedmetadata', () => {
        try { v.playbackRate = 0.7; } catch(e){}
      });

      // Fallback text
      v.appendChild(document.createTextNode('Sorry, your browser doesn’t support embedded videos.'));

      return v;
    }

    // Default: image
    const img = document.createElement('img');
    img.src = url;
    img.alt = altText;
    img.loading = 'lazy';
    return img;
  }

  services.forEach(svc => grid.appendChild(makeTile(svc)));
})();
</script>
</body>
</html>
