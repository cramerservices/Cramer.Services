<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Book Service</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f8f9fb;--card:#fff;--accent:#0d6efd;--text:#1b1f24;--muted:#6c757d;--ring:0 0 0 3px rgba(13,110,253,.25)}
  *{box-sizing:border-box}
  body{margin:0;font-family:Poppins,Arial,sans-serif;background:var(--bg);color:var(--text)}
  .wrap{max-width:720px;margin:2rem auto;padding:1rem}
  .card{background:var(--card);border:1px solid #dee2e6;border-radius:12px;padding:1rem 1.2rem}
  h1{margin:.2rem 0 1rem}
  form{display:grid;gap:.8rem;margin-top:1rem}
  input,textarea{width:100%;padding:.75rem;border:1px solid #ced4da;border-radius:6px}
  input:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:var(--ring)}
  .cta{display:inline-block;background:var(--accent);color:#fff;padding:.75rem 1rem;border-radius:8px;text-decoration:none;border:0;cursor:pointer;font-weight:600}
  .muted{color:var(--muted)}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="card">
      <h1 id="pageTitle">Book Service</h1>
      <p id="pageSub" class="muted">Fill this out and we’ll reach out to confirm details and scheduling.</p>

      <form id="bookForm" novalidate>
        <div class="row">
          <input name="name"  placeholder="Full Name" required>
          <input name="phone" placeholder="Phone" required>
        </div>
        <div class="row">
          <input name="email" type="email" placeholder="Email" required>
          <input name="address" class="full" style="grid-column:1/-1" placeholder="Service Address (Street, City, State)" required>
        </div>

        <textarea name="notes" rows="4" placeholder="Please share as many details about your project as possible. The more we know, the better we can serve you."></textarea>

        <button class="cta" type="submit">Submit</button>
        <p id="msg" class="muted" aria-live="polite"></p>
      </form>
    </div>
  </div>

  <!-- EmailJS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // === Use your existing keys ===
    const EMAILJS_PUBLIC_KEY  = 'TDIki3rqftcomcjJC';
    const EMAILJS_SERVICE_ID  = 'service_ebrskb5';
    const EMAILJS_TEMPLATE_ID = 'template_b95xw46';

    // Utility
    const $$ = sel => document.querySelector(sel);
    function show(text, err=false){
      const el = $$('#msg');
      el.textContent = text;
      el.style.color = err ? '#dc3545' : '#6c757d';
    }
    function fmtUSD(n){
      const v = Number(n);
      return isFinite(v) ? v.toLocaleString(undefined, { style:'currency', currency:'USD' }) : '';
    }

    // Read URL params
    const params = new URLSearchParams(location.search);
    const serviceName = params.get('service') || 'Service';
    const rawPrice    = params.get('price'); // optional

    // Update title & subtitle
    (function(){
      const title = $$('#pageTitle');
      const sub   = $$('#pageSub');

      let priceText = '';
      if (rawPrice && rawPrice.trim() !== '' && !isNaN(Number(rawPrice))) {
        priceText = ' — ' + fmtUSD(rawPrice);
      }
      title.textContent = `Book ${serviceName}${priceText}`;
      sub.textContent   = 'Fill this out and we’ll reach out to confirm details and scheduling.';
    })();

    document.addEventListener('DOMContentLoaded', () => {
      if (!window.emailjs) {
        console.error('EmailJS SDK failed to load');
        show('Could not load mail service. Please refresh and try again.', true);
        return;
      }
      emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });

      const f = $$('#bookForm');
      const card = $$('#card');

      f.addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
          subject: `Booking — ${serviceName}`,
          service: serviceName,
          price:   rawPrice || '',
          name:    (f.name.value || '').trim(),
          phone:   (f.phone.value || '').trim(),
          email:   (f.email.value || '').trim(),
          address: (f.address.value || '').trim(),
          notes:   (f.notes.value || '').trim(),
          time:    new Date().toLocaleString()
        };

        if (!data.name || !data.phone || !data.email || !data.address) {
          show('Please complete all required fields.', true); return;
        }

        const btn = f.querySelector('button[type="submit"]');
        const prev = btn.textContent; btn.disabled = true; btn.textContent = 'Submitting…'; show('');

        try {
          await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, data);

          // Replace the form with a thank-you message
          card.innerHTML = `
            <h1>Thank you!</h1>
            <p class="muted">We received your request for <b>${serviceName}</b>. We’ll get back to you as soon as possible.</p>
          `;

        } catch (err) {
          console.error(err);
          show('Could not submit. Please try again or email cramerservicesllc@gmail.com', true);
          btn.disabled = false; btn.textContent = prev;
        }
      });
    });
  </script>
</body>
</html>
